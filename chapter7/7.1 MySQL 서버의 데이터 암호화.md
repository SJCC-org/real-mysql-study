# 7.1 MySQL 서버의 데이터 암호화

MySQL 서버의 암호화 기능은 데이터베이스 서버와 디스크 사이의 데이터 읽고 쓰기 지점에서 암호화 또는 복호화를 수행하므로 MySQL 서버에서 디스크 입출력 이외의 부분에서는 암호화 처리가 전혀 필요치 않다. 즉, MySQL 서버(InnoDB 스토리지 엔진)의 I/O 레이어에서만 데이터의 암호화 및 복호화 과정이 실행되는 것이다.

MySQL 서버에서 사용자의 쿼리를 처리하는 과정에서 테이블의 데이터가 암호화돼 있는지 여부를 식별할 필요가 없으며, 암호화된 테이블도 그렇지 않은 테이블과 동일한 처리 과정을 거친다. 데이터 암호화 기능이 활성화돼 있다고 하더라도 MySQL 내부와 사용자 입장에서는 아무런 차이가 없기 때문에 이러한 암호화 방식을 가리켜 TDE(Transparent Data Encryption)이라고 한다.

## 7.1.1 2단계 키 관리

- MySQL 서버의 TDE에서 암호화 키는 키링(KeyRing) 플러그인에 의해 관리
- 키링 플러그인은 2단계(2-Tier) 키 관리 방식을 사용
- MySQL 서버의 TDE에서 지원하는 암호화 알고리즘은 AES 256
- MySQL 서버의 데이터 암호화는 마스터 키(master key)와 테이블스페이스 키(tablespace key)라는 두 가지 종류의 키를 가짐
  - 테이블스페이스 키는 절대 MySQL 서버 외부로 노출되지 않기 때문에 주기적으로 변경하지 않아도 됨
  - 마스터 키는 외부의 파일을 이용하므로 노출될 가능성이 있기 때문에 주기적으로 변경

```sql
-- MySQL 서버의 마스터키 변경
ALTER INSTANCE ROTATE INNODB MASTER KEY;
```

## 7.1.2 암호화와 성능

- MySQL 서버의 암호화는 TDE 방식이기 때문에 디스크로부터 한 번 읽은 데이터 페이지는 복호화되어 InnoDB의 버퍼 풀에 적재
- 존재하지 않는 데이터 페이지를 읽어야 하는 경우에는 복호화 과정을 거치기 때문에 복호화 시간 만큼의 쿼리 지연
