# 4.3 MyISAM 스토리지 엔진 아키텍처

## 4.3.1 키 캐시

- InnoDB의 버퍼 풀과 비슷한 역할
- 인덱스만을 대상으로 작동
- 인덱스의 디스크 쓰기 작업에 대해서만 부분적으로 버퍼링
- 키 캐시 히트율(Hit rate) = 100 - (Key_reads / Key_read_requests * 100)
  - Key_reads: 인덱스를 디스크에서 읽어 들인 횟수를 저장하는 상태 변수
  - Key_read_requests: 키 캐시로부터 인덱스를 읽은 횟수를 저장하는 상태 변수
  - 99% 이상으로 유지

```sql
-- Key_reads, Key_read_requests 상태변수 확인
SHOW GLOBAL STATUS LIKE 'Key%';
```

## 4.3.2 운영체제의 캐시 및 버퍼

- MyISAM 스토리지 엔진은 MyISAM 테이블의 데이터에 대해 디스크로부터 I/O를 해결해 줄 만한 어떠한 캐시나 버퍼링 기능도 가지고 있지 않음
  - 테이블의 데이터 읽기나 쓰기 작업은 항상 운영체제의 디스크 읽기 또는 쓰기 작업으로 요청
  - 대부분의 운영체제는 디스크로부터 읽고 쓰는 파일에 대한 캐시나 버퍼링 매커니즘이 탑재
- 운영체제의 캐시 공간은 남는 메모리를 사용하는 것이 기본
  - 키 캐시는 최대 물리 메모리의 40% 이상을 넘지 않게 설정
  - 나머지 메모리 공간은 운영체제가 자체적인 파일 시스템을 위한 캐시공간을 마련할 수 있도록

## 4.3.3 데이터 파일과 프라이머리 키(인덱스) 구조

- MyISAM 테이블은 프라이머리 키에 의한 클러스터링 없이 데이터 파일이 힙(Heap) 공간 처럼 활용
  - MyISAM 테이블에 레코드는 프라이머리 키 값과 무관하게 INSERT되는 순서대로 데이터 파일에 저장
- MyISAM 테이블에 저장되는 레코드는 모두 `ROWID`라는 물리적인 주솟값을 가짐
- 프라이머리 키와 세컨더리 인덱스는 모두 데이터 파일에 저장된 레코드의 `ROWID` 값을 포인터로 가짐

### ROWID

#### 고정 길이 ROWID

- 자주 사용 X
- MyISAM 테이블을 생성할 때 MAX_ROWS 옵션을 명시하면 서버는 최대로 가질 수 있는 레코드가 한정된 테이블을 생성
- 4바이트 정수 ROWID 를 사용
- INSERT된 순번이 ROWID로 사용

#### 가변 길이 ROWID

- MyISAM 테이블을 생성할 때 MAX_ROWS 옵션을 설정하지 않으면 MyISAM 테이블의 ROWID는 최대 `myisam_data_pointer_size` 시스템 변수에 설정된 바이트 수 만큼의 공간 사용 가능
- `myisam_data_pointer_size` 기본값 7 -> 2 ~ 7 바이트까지의 가변적인 ROWID 저장
- 첫 번째 바이트는 ROWID 길이, 나머지 공간은 실제 ROWID
