# 4.4 MySQL 로그 파일

## 4.4.1 에러 로그 파일

> MySQL이 실행되는 도중에 발생하는 에러나 경고 메시지가 출력되는 로그 파일

- my.cnf에서 log_error 파라미터로 정의된 경로에 생성
- 별도로 정의되지 않은 경우 데이터 디렉터리(data_dir 파라미터에 설정된 디렉터리)에 생성
- .err 확장자가 붙은 파일로 생성

### 4.4.1.1 MySQL이 시작하는 과정과 관련된 정보성 및 에러 메시지

MySQL의 설정 파일을 변경하거나 데이터베이스가 비정상적으로 종료된 이후 다시시작하는 경우에는 반드시 MySQL 에러 로그 파일을 통해 설정된 변수의 이름이나 값이 명확하게 설정되고 의도한 대로 적용됐는지 확인

### 4.4.1.2 마지막으로 종료할 때 비정상적으로 종료된 경우 나타나는 InnoDB의 트랜잭션 복구 메시지

InnoDB의 경우 MySQL 서버가 비정상적 또는 강제적으로 종료됐다면 다시 시작되면서 완료되지 못한 트랜잭션을 정리하고 디스크에 기록되지 못한 데이터가 있다면 다시 기록하는 재처리 작업을 하게 됨

### 4.4.1.3 쿼리 처리 도중에 발생하는 문제에 대한 에러 메시지

쿼리 도중 발생하는 문제

### 4.4.1.4 비정상적으로 종료된 커넥션 메시지(Aborted connection)

클라이언트 애플리케이션에서 정상적으로 접속 종료를 하지 못하고 프로그램이 종료된 경우

### 4.4.1.5 InnoDB의 모니터링 또는 상태 조회 명령(SHOW ENGINE INNODB STATUS 같은)의 결과 메시지

InnoDB의 테이블 모니터링이나 락모니터링, 또는 InnoDB의 엔진 상태를 조회하는 명령은 상대적으로 큰 메시지를 에러 로그 파일에 기록하므로 InnoDB의 모니터링을 사용한 이후에는 다시 비활성화해서 에러 로그 파일이 커지지 않게 만들어야 한다.

### 4.4.1.6 MySQL의 종료 메시지

MySQL 서버가 왜 종료됐는지 확인하는 유일한 방법

## 4.4.2 제너럴 쿼리 로그 파일(제너럴 로그 파일, General log)

- 쿼리 로그를 활성화 하면 쿼리를 쿼리 로그 파일로 기록하게됨
- 슬로우 쿼리 로그와는 조금 다르게 제너럴 쿼리 로그는 실행되기 전에 MySQL이 쿼리 요청을 받으면 바로 기록하기 때문에 쿼리 실행 중에 에러가 발생해도 일단 로그 파일에 기록
- `general_log_file`: 쿼리 로그 파일 경로
- `log_output`: 쿼리 로그를 파일로 저장할지 테이블로 저장할지

## 4.4.3 슬로우 쿼리 로그

- 서비스 운영중에 MySQL 서버의 전체적인 점검을 위한 튜닝에서 어떤 쿼리가 문제인지 판단하는데 도움
- `long_query_time` 시스템 변수에 설정한 시간 이상의 시간이 소요된 쿼리가 모두 기록
- 실제 소요된 시간을 기준으로 슬로우 쿼리 로그에 기록할지 여부를 판단하기 때문에 반드시 쿼리가 정상적으로 실행이 완료되어야 함
- `long_output`: 슬로우 쿼리 로그를 파일로 기록할지 테이블로 기록할지 선택
- 일반적으로 슬로우 쿼리 또는 제너럴 로그 파일의 내용이 상당히 많아서 [Percona Toolkit](https://percona.com/doc/percona-toolkit/LATEST/index.html) 의 `pt-query-digest` 스크립트를 이용해서 쿼리를 빈도나 처리 성능별로 정렬

```bash
## General Log 파일 분석
pt-query-digest --type='genlog' general.log > parsed_general.log

## Slow Log 파일 분석
pt-query-digest --type='slowlog' mysql-slow.log > parsed_mysql-slow.log
```

### 4.4.3.1 슬로우 쿼리 통계

- 분석 결과의 최상단에 표시
- 모든 쿼리를 대상으로 슬로우 쿼리 로그의 실행 시간(Exec time), 잠금 대기 시간(Lock time) 등에 대해 평균 및 최소/최대 값 표시

### 4.4.3.2 실행 빈도 및 누적 실행 시간순 랭킹

- 각 쿼리 별로 응답 시간과 실행 횟수
- Query ID: 실행된 쿼리 문장을 정규화해서 만들어진 해시 값

### 4.4.3.3 쿼리별 실행 횟수 및 누적 실행 시간 상세 정보

- Query Id 별 쿼리를 쿼리 랭킹에 표시된 순서대로 자세한 내용을 보여줌
- 쿼리가 얼마나 실행됐는지, 쿼리의 응답 시간에 대한 히스토그램 등 상세한 내용
