## 7.5 바이너리 로그 암호화
- 테이블 암호화가 적용돼도 바이너리 로그와 릴레이 로그 파일도 리두 로그나 언두 로그처럼 평문을 저장
- 바이너리 로그 파일의 암호화는 상황에 따라 중요도가 높아질 수 있음
- 바이너리 로그와 릴레이 로그 파일 암호화 기능은 디스크에 저장된 로그 파일에 대한 암호화만 담당
  - MySQL 서버의 메모리 내부 또는 소스 서버와 레플리카 서버 간의 네트워크 구간에서 로그 데이터를 암호화하지 않음
  - 네트워크 구간에서도 바이너리 로그를 암호화하려면 MySQL 복제를 위한 계정이 SSL을 사용하도록 설정하면 됨

### 7.5.1 바이너리 로그 암호화 키 관리
- 바이너리 로그와 릴레이 로그 파일 데이터의 암호화를 위해서도 2단계 암호화 키 관리 방식 사용
  - 바이너리 로그와 릴레이 로그 파일의 데이터는 파일 키로 암호화해서 디스크로 저장
  - 파일 키는 `바이너리 로그 암호화 키`로 암호화해서 각 바이너리 로그와 릴레이 로그 파일의 헤더에 저장
  - `바이너리 로그 암호화 키`는 마스터 키와 동일한 역할을 하며, 파일 키는 로그 파일 단위로 자동으로 생성되어 해당 로그 파일의 데이터 암호화에만 사용

### 7.5.2 바이너리 로그 암호화 키 변경
- 바이너리 로그 암호화 키는 다음과 같이 변경(Rotation)
```sql
ALTER INSTANCE ROTATE BINLOG MASTER KEY;
```
- 바이너리 로그 암호화 키가 변경되는 과정
  1. 증가된 시퀀스 번호와 함께 새로운 바이너리 로그 암호화 키 발급 후 키링 파일에 저장
  2. 바이너리 로그 파일과 릴레이 로그 파일 스위치(새로운 로그 파일로 로테이션)
  3. 새로 생성되는 바이너리 로그와 릴레이 로그 파일의 암호화를 위해 파일 키를 생성하고, 파일 키는 바이너리 로그 파일 키(마스터 키)로 암호화해서 각 로그 파일에 저장
  4. 기존 바이너리 로그와 릴레이 로그 파일의 파일 키를 읽어서 새로운 바이너리 로그 파일 키로 암호화해서 다시 저장(암호화되지 않은 로그 파일은 무시)
  5. 모든 바이너리 로그와 릴레이 로그 파일이 새로운 바이너리 로그 암호화 키로 다시 암호화됐다면 기존 바이너리 로그 암호화 키를 키링 파일에서 제거
- 바이너리 로그 암호화키가 내부적으로 버전 관리(시퀀스 번호)를 하는 이유
  - 바이너리 로그와 릴레이 로그 파일들은 시퀀스 번호 순서대로 파일 키를 다시 암호화해서 저장
  - 새로운 바이너리 로그 암호화 키로 암호화되어 저장되면 기존 바이너리 로그 암호화 키는 필요하지 않으므로 키링 파일에서 제거
- 바이너리 로그 파일이 암호화돼 있는지 여부 확인
```sql
SHOW BINARY LOGS;
```

### 7.5.3 mysqlbinlog 도구 활용
- 한 번 바이너리 로그 파일이 암호화되면 바이너리 로그 암호화 키가 없으면 복호화 불가능
- 바이너리 로그 암호화 키는 MySQL 서버만 가지고 있기 때문에 `mysqlbinlog` 도구만으로는 복호활 방법이 없음
- 바이너리 로그 파일의 내용을 볼 수 있는 방법은 MySQL 서버를 통해 가져오는 방법이 유일
- mysqlbinlog 명령을 실행할 때 `--read-from-remote-server` 파라미터와 함께 MySQL 서버 접속 정보 입력
```shell
$ mysqlbinlog --read-from-remote-server -uroot -p -vvv ${BIN_LOG}
```